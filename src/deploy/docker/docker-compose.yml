version: "3.7"

services:
  calle-service:
    container_name: calle-service_${STACK_NAME}
    image: goafabric/calle-service${ARCH_SUFFIX}:1.0.3-SNAPSHOT
    restart: 'no'
    ports:
      - "50900:50900"

    entrypoint: ["java","-Xms${SERVICE_MEM}","-Xmx${SERVICE_MEM}",
                 "-Djava.security.egd=file:/dev/./urandom","-cp","/app/resources:/app/classes:/app/libs/*","org.goafabric.calleservice.Application"]
    healthcheck:
      test: "curl -f http://localhost:50900/actuator/health || exit 1"
      interval: 15s
      timeout: 10s
      retries: 5
    volumes:
      - applogs:/app/logs
    networks:
      - calle-service-net
    environment:
      - TZ=Europe/Berlin
      - security.authentication.enabled=false
      #log levels
      - logging.level.root=WARN
      - logging.level.org.goafabric=INFO
      - logging.level.org.springframework=INFO
      - logging.level.org.flywaydb.core=INFO
      - logging.level.org.hibernate.SQL=INFO
      #log standard settings
      - logging.file.max-size=10MB
      - logging.file.name=/usr/share/logs/application.log
      - logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n%throwable
      #- logging.pattern.console=%white(%d{ISO8601}) %highlight(%-5level) [%blue(%t)] %yellow(%C{1.}) %msg%n%throwable

volumes:
    applogs:

networks:
  calle-service-net:
    driver: bridge